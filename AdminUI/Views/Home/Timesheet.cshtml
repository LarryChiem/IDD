@model Common.Models.Timesheet

@{
    ViewData["Title"] = "Timesheet";
    var permission = Model.LockInfo.User.Equals(User.Identity.Name, StringComparison.CurrentCultureIgnoreCase);
}
<div class="container">
    @if (!permission)
    {
        <div class="alert alert-danger"><h1>Sheet is locked by @Model.LockInfo.User</h1></div>
    }

<div class="flex-container column">
    <h1>eXPRS Plan of Care - Services Delivered Report Form</h1>
    <div class="row">
        <div class="column">
            <label for="client-name">Timesheet ID:</label> @Model.Id
        </div>
        <div class="column">
            @if (String.IsNullOrEmpty(Model.Status) || Model.Status.Equals("Pending", StringComparison.CurrentCultureIgnoreCase))
            {
                <label asp-for="Status">Status of Timesheet:</label> <span>Pending</span>
            }
            else
            {
                <label asp-for="Status">Status of Timesheet:</label> @Model.UserActivity
            }
        </div>
    </div>
    <div class="row">
        <div class="column">
            <label for="client-name">Customer Name:</label> @Model.ClientName
        </div>
        <div class="column">
            <label for="prime">Prime:</label> @Model.ClientPrime
        </div>
    </div>
    <div class="row">
        <div class="column">
            <label for="provider-name">Provider Name:</label> @Model.ProviderName
        </div>
        <div class="column">
            <label for="provider-num">Provider Num:</label> @Model.ProviderId
        </div>
    </div>
    <div class="row">
        <div class="column">
            <label for="service-authorized">Service Authorized:</label>  @Model.FormType
        </div>
        <div class="column">
            <label>Submitted on:</label> @Model.Submitted.ToString("MM-dd-yyyy")
        </div>
    </div>
    <div>
        <table class="table table-striped table-bordered table-hover">
            <caption>Service Log for Timesheet ID @Model.Id</caption>
            <thead>
                <tr>
                    <th scope="col">Date</th>
                    <th scope="col">Start/Time IN</th>
                    <th scope="col">End/Time OUT</th>
                    <th scope="col">Total Hours for Entry</th>
                    <th scope="col">Group? (yes/no)</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var t in Model.TimeEntries)
                {
                    <tr>
                        <td>@t.Date.ToString("d")</td>
                        <td>@t.In.ToString("h:mm tt")</td>
                        <td>@t.Out.ToString("h:mm tt")</td>
                        <td>@t.Hours</td>
                        @if (t.Group)
                        {
                            <td>Yes</td>
                        }
                        else
                        {
                            <td>No</td>

                        }
                    </tr>
                }
                </tbody>
                <tfoot>
                    <tr class="table-success font-weight-bold">
                        <th colspan="3" style="text-align: right;">Total:</th>
                        <td colspan="2">@Model.TotalHours Hours</td>
                    </tr>
                </tfoot>
            </table>
        </div>

    <div class="row m-1 border">
        <div class="column">
            <label>SERVICE GOAL:</label>  @Model.ServiceGoal
        </div>
    </div>
    <div class="row m-1 border">
        <div class="column">
            <label>PROGRESS NOTES:</label>  @Model.ProgressNotes
        </div>
    </div>
    @if (permission)
    {
        <div class="fixed-bottom row d-flex justify-content-center" id="bottom-sticky">
            <form asp-controller="Submission" asp-action="Process">
                <div class="row">
                    <label>Review Timesheet Action:</label>
                    <input type="hidden" name="id" value="@Model.Id"/>
                    <input onclick="handleAccepted" class="btn btn-primary" name="Status" value="Approved" type="submit">
                    <input onclick="handleRejected" class="btn btn-danger" name="Status" value="Rejected" type="submit">
                    <input type="text" name="RejectionReason" placeholder="Rejection reason..."/>
                    @Html.ActionLink("Download PDF", "GenPDF", "Submission", new { id = Model.Id }, new { @class = "btn btn-info aToInput" })
                </div>
            </form>
        </div>
    }
    <div class="row">
        @{ 
            int i = 0;
            var side = "";
        }
        @foreach (var uri in Model.UriList)
        {
            <div class="column">
                <div class="container">
                    <a target="_blank" href="@Href(uri)">
                        @if (i == 0) //This is assuming that the UriString has starts with the "front.png,back.png".
                        {
                            side = "Front";
                        }
                        else 
                        {
                            side = "Back"; 
                        }
                        <img src="@Href(uri)" alt="Sample @side" class="img-thumbnail image" />
                        <div class="overlay">
                            <div class="textoverlay">@side of Timesheet</div>
                        </div>
                    </a>
                </div>
            </div>
            i = i + 1;
        }
    </div> <!--End of div.row-->
</div>
</div>
